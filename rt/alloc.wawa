global i32 heap_base
global i32 heap_tip

func malloc
sz i32 i32
	loadg heap_tip
	loadg heap_tip
	loadl sz
	i32.add
	storeg heap_tip
	loop
		loadg heap_tip
		current_memory
		i32.lt_u
		br_if 0
		i32 1
		grow_memory
		drop
	end
	ret

func free
p i32 void
	ret

func realloc
p i32 sz i32 i32
np i32
	load sz
	call malloc
	tee np
	load p
	load sz
	call memcpy
	load p
	call free
	load np
	ret
